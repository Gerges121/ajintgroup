<?php
/*
Template Name: Single Product
Template Post Type: products
*/

$post_id = get_the_ID();
get_header();
?>


<?php

if (have_posts()) :
  while (have_posts()) : the_post();
    ?>


    <div class="container">
      <div class="productDetails">
        <div class="rightSection">
          <div class="allCards">
            <div class="card">
              <img class="cardImage" src="<?php echo get_the_post_thumbnail() ?>

            </div>
            <div class="card">
              <img class="cardImage" src="<?php echo get_the_post_thumbnail() ?>
            </div>
            <div class="card">
              <img class="cardImage" src="<?php echo get_the_post_thumbnail() ?>
            </div>
          </div>
          <div class="bigCard">
            <img class="bigCardImage" src="<?php echo get_the_post_thumbnail() ?>

          </div>
        </div>
        <div class="leftSection">
          <div class="headingAndSigns">
            <div class="heading">
              <h1><?php the_title() ?></h1>
            </div>
            <div class="signs">
              <div class="loveIcon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="19" viewBox="0 0 20 19" fill="none">
                  <path d="M14.5832 0.597656C13.6448 0.612252 12.7269 0.874201 11.9222 1.35705C11.1174 1.8399 10.4544 2.52655 9.99988 3.34766C9.54542 2.52655 8.88233 1.8399 8.07758 1.35705C7.27283 0.874201 6.35493 0.612252 5.41655 0.597656C3.92067 0.662649 2.51131 1.31703 1.49637 2.41785C0.481433 3.51867 -0.0565749 4.97643 -0.000116138 6.47266C-0.000116138 10.2618 3.98822 14.4002 7.33322 17.206C8.08007 17.8336 9.02435 18.1777 9.99988 18.1777C10.9754 18.1777 11.9197 17.8336 12.6665 17.206C16.0115 14.4002 19.9999 10.2618 19.9999 6.47266C20.0563 4.97643 19.5183 3.51867 18.5034 2.41785C17.4885 1.31703 16.0791 0.662649 14.5832 0.597656ZM11.5957 15.931C11.149 16.3071 10.5838 16.5134 9.99988 16.5134C9.41592 16.5134 8.85073 16.3071 8.40405 15.931C4.12238 12.3385 1.66655 8.89182 1.66655 6.47266C1.60958 5.41825 1.97186 4.3841 2.67435 3.59574C3.37685 2.80738 4.36258 2.32878 5.41655 2.26432C6.47052 2.32878 7.45625 2.80738 8.15875 3.59574C8.86125 4.3841 9.22352 5.41825 9.16655 6.47266C9.16655 6.69367 9.25435 6.90563 9.41063 7.06191C9.56691 7.21819 9.77887 7.30599 9.99988 7.30599C10.2209 7.30599 10.4329 7.21819 10.5891 7.06191C10.7454 6.90563 10.8332 6.69367 10.8332 6.47266C10.7763 5.41825 11.1385 4.3841 11.841 3.59574C12.5435 2.80738 13.5292 2.32878 14.5832 2.26432C15.6372 2.32878 16.6229 2.80738 17.3254 3.59574C18.0279 4.3841 18.3902 5.41825 18.3332 6.47266C18.3332 8.89182 15.8774 12.3385 11.5957 15.9277V15.931Z" fill="#023047"/>
                </svg>
              </div>
              <div class="shareIcon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                  <g clip-path="url(#clip0_1134_1708)">
                    <path d="M16.1095 12.2227C15.4794 12.2232 14.859 12.377 14.3016 12.6709C13.7442 12.9647 13.2668 13.3898 12.9103 13.9094L7.48618 11.4602C7.87144 10.5299 7.87294 9.48495 7.49035 8.55354L12.907 6.09187C13.4352 6.85584 14.2198 7.40518 15.1183 7.64024C16.0169 7.87531 16.9699 7.78054 17.8046 7.37312C18.6393 6.9657 19.3003 6.27262 19.6677 5.41959C20.0352 4.56657 20.0847 3.6101 19.8073 2.72368C19.53 1.83727 18.9441 1.07962 18.156 0.588169C17.3678 0.0967179 16.4297 -0.0959833 15.5116 0.0450196C14.5936 0.186023 13.7565 0.65139 13.1522 1.35671C12.5479 2.06203 12.2164 2.96058 12.2178 3.88937C12.2214 4.10921 12.2437 4.32834 12.2845 4.54437L6.52618 7.16104C5.97313 6.64289 5.28077 6.29757 4.53416 6.16751C3.78755 6.03745 3.01921 6.1283 2.32352 6.42892C1.62784 6.72954 1.03512 7.22682 0.618179 7.85967C0.201238 8.49253 -0.021763 9.23339 -0.0234281 9.99125C-0.0250932 10.7491 0.19465 11.4909 0.608806 12.1256C1.02296 12.7603 1.61349 13.2602 2.30785 13.5639C3.0022 13.8675 3.77014 13.9618 4.51731 13.835C5.26449 13.7082 5.95836 13.3659 6.51368 12.8502L12.287 15.4569C12.2469 15.6727 12.2249 15.8915 12.2212 16.111C12.221 16.8803 12.449 17.6324 12.8763 18.2721C13.3036 18.9118 13.911 19.4104 14.6216 19.7048C15.3323 19.9993 16.1144 20.0764 16.8689 19.9264C17.6234 19.7763 18.3164 19.4059 18.8604 18.8619C19.4044 18.318 19.7748 17.6249 19.9248 16.8704C20.0749 16.1159 19.9978 15.3339 19.7033 14.6232C19.4088 13.9125 18.9102 13.3051 18.2705 12.8778C17.6308 12.4505 16.8788 12.2225 16.1095 12.2227ZM16.1095 1.66687C16.5491 1.66671 16.9789 1.79692 17.3445 2.04103C17.7101 2.28514 17.9951 2.63219 18.1634 3.03828C18.3318 3.44438 18.3759 3.89127 18.2902 4.32245C18.2046 4.75363 17.993 5.14972 17.6822 5.46062C17.3714 5.77153 16.9754 5.98328 16.5442 6.06911C16.1131 6.15493 15.6662 6.11097 15.26 5.94277C14.8539 5.77458 14.5067 5.48972 14.2625 5.12421C14.0182 4.75871 13.8878 4.32898 13.8878 3.88937C13.8883 3.30021 14.1225 2.73529 14.539 2.31861C14.9555 1.90193 15.5204 1.66754 16.1095 1.66687ZM3.88785 12.2227C3.44824 12.2229 3.01847 12.0927 2.65287 11.8486C2.28727 11.6044 2.00228 11.2574 1.83393 10.8513C1.66559 10.4452 1.62146 9.99831 1.70712 9.56713C1.79278 9.13595 2.00439 8.73986 2.31518 8.42896C2.62597 8.11805 3.02198 7.9063 3.45312 7.82047C3.88427 7.73465 4.33118 7.77861 4.73734 7.9468C5.14349 8.115 5.49065 8.39986 5.7349 8.76536C5.97915 9.13087 6.10952 9.5606 6.10952 10.0002C6.10885 10.5893 5.8746 11.1541 5.45812 11.5707C5.04165 11.9874 4.47694 12.2218 3.88785 12.2227ZM16.1095 18.3335C15.6699 18.3335 15.2402 18.2032 14.8748 17.959C14.5093 17.7148 14.2244 17.3677 14.0562 16.9616C13.888 16.5554 13.844 16.1086 13.9297 15.6775C14.0155 15.2463 14.2271 14.8503 14.538 14.5395C14.8488 14.2287 15.2448 14.017 15.6759 13.9312C16.107 13.8455 16.5539 13.8895 16.96 14.0577C17.3661 14.2259 17.7132 14.5108 17.9575 14.8763C18.2017 15.2418 18.332 15.6715 18.332 16.111C18.3316 16.7003 18.0973 17.2654 17.6806 17.6821C17.2639 18.0988 16.6988 18.3331 16.1095 18.3335Z" fill="#023047"/>
                  </g>
                  <defs>
                    <clipPath id="clip0_1134_1708">
                      <rect width="20" height="20" fill="white"/>
                    </clipPath>
                  </defs>
                </svg>
              </div>
            </div>
          </div>
          <div class="carouselImageForMobile">
            <div class="signsForMobile">
              <div class="loveIcon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="19" viewBox="0 0 20 19" fill="none">
                  <path d="M14.5832 0.597656C13.6448 0.612252 12.7269 0.874201 11.9222 1.35705C11.1174 1.8399 10.4544 2.52655 9.99988 3.34766C9.54542 2.52655 8.88233 1.8399 8.07758 1.35705C7.27283 0.874201 6.35493 0.612252 5.41655 0.597656C3.92067 0.662649 2.51131 1.31703 1.49637 2.41785C0.481433 3.51867 -0.0565749 4.97643 -0.000116138 6.47266C-0.000116138 10.2618 3.98822 14.4002 7.33322 17.206C8.08007 17.8336 9.02435 18.1777 9.99988 18.1777C10.9754 18.1777 11.9197 17.8336 12.6665 17.206C16.0115 14.4002 19.9999 10.2618 19.9999 6.47266C20.0563 4.97643 19.5183 3.51867 18.5034 2.41785C17.4885 1.31703 16.0791 0.662649 14.5832 0.597656ZM11.5957 15.931C11.149 16.3071 10.5838 16.5134 9.99988 16.5134C9.41592 16.5134 8.85073 16.3071 8.40405 15.931C4.12238 12.3385 1.66655 8.89182 1.66655 6.47266C1.60958 5.41825 1.97186 4.3841 2.67435 3.59574C3.37685 2.80738 4.36258 2.32878 5.41655 2.26432C6.47052 2.32878 7.45625 2.80738 8.15875 3.59574C8.86125 4.3841 9.22352 5.41825 9.16655 6.47266C9.16655 6.69367 9.25435 6.90563 9.41063 7.06191C9.56691 7.21819 9.77887 7.30599 9.99988 7.30599C10.2209 7.30599 10.4329 7.21819 10.5891 7.06191C10.7454 6.90563 10.8332 6.69367 10.8332 6.47266C10.7763 5.41825 11.1385 4.3841 11.841 3.59574C12.5435 2.80738 13.5292 2.32878 14.5832 2.26432C15.6372 2.32878 16.6229 2.80738 17.3254 3.59574C18.0279 4.3841 18.3902 5.41825 18.3332 6.47266C18.3332 8.89182 15.8774 12.3385 11.5957 15.9277V15.931Z" fill="#023047"/>
                </svg>
              </div>
              <div class="shareIcon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                  <g clip-path="url(#clip0_1134_1708)">
                    <path d="M16.1095 12.2227C15.4794 12.2232 14.859 12.377 14.3016 12.6709C13.7442 12.9647 13.2668 13.3898 12.9103 13.9094L7.48618 11.4602C7.87144 10.5299 7.87294 9.48495 7.49035 8.55354L12.907 6.09187C13.4352 6.85584 14.2198 7.40518 15.1183 7.64024C16.0169 7.87531 16.9699 7.78054 17.8046 7.37312C18.6393 6.9657 19.3003 6.27262 19.6677 5.41959C20.0352 4.56657 20.0847 3.6101 19.8073 2.72368C19.53 1.83727 18.9441 1.07962 18.156 0.588169C17.3678 0.0967179 16.4297 -0.0959833 15.5116 0.0450196C14.5936 0.186023 13.7565 0.65139 13.1522 1.35671C12.5479 2.06203 12.2164 2.96058 12.2178 3.88937C12.2214 4.10921 12.2437 4.32834 12.2845 4.54437L6.52618 7.16104C5.97313 6.64289 5.28077 6.29757 4.53416 6.16751C3.78755 6.03745 3.01921 6.1283 2.32352 6.42892C1.62784 6.72954 1.03512 7.22682 0.618179 7.85967C0.201238 8.49253 -0.021763 9.23339 -0.0234281 9.99125C-0.0250932 10.7491 0.19465 11.4909 0.608806 12.1256C1.02296 12.7603 1.61349 13.2602 2.30785 13.5639C3.0022 13.8675 3.77014 13.9618 4.51731 13.835C5.26449 13.7082 5.95836 13.3659 6.51368 12.8502L12.287 15.4569C12.2469 15.6727 12.2249 15.8915 12.2212 16.111C12.221 16.8803 12.449 17.6324 12.8763 18.2721C13.3036 18.9118 13.911 19.4104 14.6216 19.7048C15.3323 19.9993 16.1144 20.0764 16.8689 19.9264C17.6234 19.7763 18.3164 19.4059 18.8604 18.8619C19.4044 18.318 19.7748 17.6249 19.9248 16.8704C20.0749 16.1159 19.9978 15.3339 19.7033 14.6232C19.4088 13.9125 18.9102 13.3051 18.2705 12.8778C17.6308 12.4505 16.8788 12.2225 16.1095 12.2227ZM16.1095 1.66687C16.5491 1.66671 16.9789 1.79692 17.3445 2.04103C17.7101 2.28514 17.9951 2.63219 18.1634 3.03828C18.3318 3.44438 18.3759 3.89127 18.2902 4.32245C18.2046 4.75363 17.993 5.14972 17.6822 5.46062C17.3714 5.77153 16.9754 5.98328 16.5442 6.06911C16.1131 6.15493 15.6662 6.11097 15.26 5.94277C14.8539 5.77458 14.5067 5.48972 14.2625 5.12421C14.0182 4.75871 13.8878 4.32898 13.8878 3.88937C13.8883 3.30021 14.1225 2.73529 14.539 2.31861C14.9555 1.90193 15.5204 1.66754 16.1095 1.66687ZM3.88785 12.2227C3.44824 12.2229 3.01847 12.0927 2.65287 11.8486C2.28727 11.6044 2.00228 11.2574 1.83393 10.8513C1.66559 10.4452 1.62146 9.99831 1.70712 9.56713C1.79278 9.13595 2.00439 8.73986 2.31518 8.42896C2.62597 8.11805 3.02198 7.9063 3.45312 7.82047C3.88427 7.73465 4.33118 7.77861 4.73734 7.9468C5.14349 8.115 5.49065 8.39986 5.7349 8.76536C5.97915 9.13087 6.10952 9.5606 6.10952 10.0002C6.10885 10.5893 5.8746 11.1541 5.45812 11.5707C5.04165 11.9874 4.47694 12.2218 3.88785 12.2227ZM16.1095 18.3335C15.6699 18.3335 15.2402 18.2032 14.8748 17.959C14.5093 17.7148 14.2244 17.3677 14.0562 16.9616C13.888 16.5554 13.844 16.1086 13.9297 15.6775C14.0155 15.2463 14.2271 14.8503 14.538 14.5395C14.8488 14.2287 15.2448 14.017 15.6759 13.9312C16.107 13.8455 16.5539 13.8895 16.96 14.0577C17.3661 14.2259 17.7132 14.5108 17.9575 14.8763C18.2017 15.2418 18.332 15.6715 18.332 16.111C18.3316 16.7003 18.0973 17.2654 17.6806 17.6821C17.2639 18.0988 16.6988 18.3331 16.1095 18.3335Z" fill="#023047"/>
                  </g>
                  <defs>
                    <clipPath id="clip0_1134_1708">
                      <rect width="20" height="20" fill="white"/>
                    </clipPath>
                  </defs>
                </svg>
              </div>
            </div>
            <div class="cardForMobile">
              <img class="cardImageForMobile" src="<?php echo get_the_post_thumbnail() ?>
            </div>
            <div class="pointing">
              <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8" fill="none">
                <circle cx="4" cy="4" r="4" fill="#023047"/>
              </svg>
              <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8" fill="none">
                <circle cx="4" cy="4" r="4" fill="#D9D9D9"/>
              </svg>
              <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8" fill="none">
                <circle cx="4" cy="4" r="4" fill="#D9D9D9"/>
              </svg>
              <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8" fill="none">
                <circle cx="4" cy="4" r="4" fill="#D9D9D9"/>
              </svg>
              <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" viewBox="0 0 8 8" fill="none">
                <circle cx="4" cy="4" r="4" fill="#D9D9D9"/>
              </svg>
            </div>
          </div>

          <div class="description">
            <?php if ( has_excerpt() ) : ?>
              <div class="product-short-description">
                <?php the_excerpt(); ?>
              </div>
            <?php endif; ?>
          </div>
          <div class="buttonBackgroundForMobile">

            <div class="addToChartButton">
              <p>Order Now</p>
            </div>
          </div>
        </div>
      </div>
    </div>


    <div class="container">
      <div class="shopProductDescriptionSection">

        <div class="shopProductDescription">

          <?php the_content() ?>

        </div>

      </div>


      <div class="relatedProductsSection">
        <h2>Related products</h2>
        <div class="shopRelatedProducts">
          <?php
          $args = array(
            'posts_per_page' => 5,
            'post_type'      => 'products', // Your custom post type
            'orderby'        => 'date',
            'order'          => 'DESC',
            'post__not_in'   => array(get_the_ID()), // Exclude the current product
            'tax_query'      => array( // فلترة بالتصنيف
              array(
                'taxonomy' => 'products category', // اسم التصنيف (الكاتيجوري الخاص بالمنتجات)
                'field'    => 'term_id', // فلترة باستخدام الـ ID الخاص بالتصنيف
                'terms'    => wp_get_post_terms(get_the_ID(), 'products category', array('fields' => 'ids')), // التصنيفات المرتبطة بالمنتج الحالي
                'operator' => 'IN', // البحث عن المنتجات في نفس التصنيفات
              ),
            ),
          );

          $recent_products = get_posts($args);
          if (!$recent_products) {
            // الاستعلام الاحتياطي: منتجات من أقسام تانية بدون فلترة بالكاتيجوري
            $args = array(
              'posts_per_page' => 5,
              'post_type'      => 'products',
              'orderby'        => 'date',
              'order'          => 'DESC',
              'post__not_in'   => array(get_the_ID()), // استثناء المنتج الحالي
            );

            $recent_products = get_posts($args);
          }

          if ($recent_products) :
            foreach ($recent_products as $product) :
              // Temporarily set the global $post variable to the current product
              setup_postdata($product);

              // Output the product card using your template part
              ?>
              <div class="productCard">
                <a href="<?php echo get_permalink($product->ID); ?>" >
                  <img class="productImage" src="<?php echo esc_url(get_the_post_thumbnail_url($product->ID, 'full') ?: get_template_directory_uri() . '/src/img/tshirtimg.webp'); ?>" alt="Product Image">
                </a>

                <div class="productInfo">
                  <a class="productName" style="text-decoration: none; color: black" href="<?php echo get_permalink($product->ID); ?>"><?php echo get_the_title($product->ID); ?> </a>
                </div>
              </div>
            <?php
            endforeach;

            // Reset global post data after the loop
            wp_reset_postdata();
          else :
            echo '<p>' . __('No related products found.', 'AJintergroup') . '</p>';
          endif;
          ?>
        </div>
      </div>
    </div>


  <?php
  endwhile;
endif;

get_footer(); // Include the footer
?>
